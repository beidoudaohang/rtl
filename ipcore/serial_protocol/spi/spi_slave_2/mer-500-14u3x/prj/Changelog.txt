---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.01.23
【测试版本】V10.01
【修改日期】2015/9/16 11:21:10
【修改人  】张强
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.01.23
2. 测试版本号为：V10.01
3. 替换了 spi slave模块，采用spi sck直接采样数据，支持连续读写。ucf中约束的spi sck最大频率是20MHz。
时序都通过，仿真也通过，需要上板子实际测试

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.01.23
【测试版本】V02.00
【修改日期】2015/8/7 17:31:53
【修改人  】张强
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.01.23
2. 测试版本号为：V20.00
3. fifo_rd_en	 = wr_flag &&( ~i_p2_wr_full ) && ( ~fifo_empty ) && o_se_2_fvalrise 只有在开采状态下才允许读和写
解决频繁重同步时0帧问题。
---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.01.22
【测试版本】V02.00
【修改日期】2015/7/19 15:55:55
【修改人  】张强
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.01.22
2. 测试版本号为：V20.00
3. 解决id1793 10bits模式下4台相机连续采集产生残帧的问题，主要是因为写指针没有立即更新导致，修改wrap_wr_logic
模块输出给wrap_rd_logic模块写指针的生效时机，在写指针变化完之后立即告知wrap_rd_logic模块，而不是等到第
一个写地址变化时才更新。
4. 修改chunkID 值 由0.1.2改为1.2.3。
---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.01.21
【测试版本】V02.00
【修改日期】2015/7/13 13:08:05
【修改人  】张强
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.01.21
2. 测试版本号为：V20.00
3. 修改流停止时，P2口burstlenth设计逻辑，为保证P2口FIFO中没有残留，停止采集时，会将ov_p2_cmd_bl设置为6'h3f
4. 修改wrap_rd_logic模块状态跳转逻辑判断 if (~se_2_fvalrise_shift[1] && (word_cnt == BURST_SIZE) ) 由原
来的空条件改为判断word_cnt == BURST_SIZE，避免因刷新和停采同时发生时的假空现象。
---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.01.20
【测试版本】V02.00
【修改日期】2015/7/7 17:44:22
【修改人  】张强
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.01.20
2. 测试版本号为：V20.00
3. 为通过U3V_Validate_SVN419协议测试工具，传输部分做了较大改动。
4. 优化frame_buffer模块wrap_wr_logic写入逻辑，将较多的组合逻辑改为时序逻辑。
5. 修改u3vformat i_trailer_flag输出宽度，并输出给frame_buffer模块，主要方便尾包单独写入帧存逻辑设计。
6. 修改u3vformat payload模块，添加了overrun检查逻辑，和validpayloadsize统计设计。
7. 修改frame_buffer模块wrap_wr_logic写入逻辑，通过判断i_trailer_flag标志将尾包单独写入16M空间的倒数第二
个256。
8. 和wrap_wr_logic逻辑对应修改wrap_rd_logic 尾包部分的读出逻辑。
9. 修改u3_transfer模块IDLE状态跳转条件，由判断电平改为判断信号沿。
10. 解决白平衡参数生效时机bug，传输期间不能生效。
---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.01.1f
【测试版本】V02.00
【修改日期】2015/6/19 11:03:26
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.01.1f
2. 测试版本号为：V20.00
3. 正常传输时，绿灯闪烁太快不能看清，改为20Hz的闪烁频率
4. io_channel line_mode_and_inverter 模块 line206
line3_out_mode	<= line2_out_invert; 改为
line3_out_mode	<= line3_out_invert;

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.01.1e
【测试版本】V02.00
【修改日期】2015/6/4 14:25:50
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.01.1e
2. 测试版本号为：V20.00
3. 添加测试管脚输出

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.01.1d
【测试版本】V02.00
【修改日期】2015/6/4 11:29:37
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.01.1d
2. 测试版本号为：V20.00
3、添加测试寄存器-fval_state

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.01.1c
【测试版本】V02.00
【修改日期】2015/6/3 16:02:57
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.01.1c
2. 测试版本号为：V20.00
3、test_image_sel 从2bit改为3bit

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.01.1b
【测试版本】V02.00
【修改日期】2015/6/3 12:56:21
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.01.1b
2. 测试版本号为：V20.00
3、修改u3_transfer.v中注释mult_en  = ~reset;		//复位之后数据不变了再计算
4、去掉packet_switch中异步复位,改为同步复位
5、修改wrap_rd_logic模块中fifo_w32d256_pf180_pe6模块例化时的端口逻辑

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.01.1a
【测试版本】V02.00
【修改日期】2015/6/3 12:23:23
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.01.1a
2. 测试版本号为：V20.00
3. 添加 gpif_state 寄存器

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.01.19
【测试版本】V02.00
【修改日期】2015/6/3 10:49:32
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.01.19
2. 测试版本号为：V20.00
3. reg list 的端口上添加异步时钟域信号的描述
4. ucf文件，跨时钟域走线，添加注释

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.01.18
【测试版本】V02.00
【修改日期】2015/6/2 13:37:32
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.01.18
2. 测试版本号为：V20.00
3. hold输出一直输出高，hold输入引到 unused_pin 上

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.01.17
【测试版本】V02.00
【修改日期】2015/5/26 13:33:49
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.01.17
2. 测试版本号为：V20.00
3. 添加led_ctrl寄存器保护功能，禁止非法数值传递到led模块

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.01.16
【测试版本】V02.00
【修改日期】2015/5/26 11:02:22
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.01.16
2. 测试版本号为：V20.00
3. physic_line0 只有bit可读写，其他的bit只读

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.01.15
【测试版本】V00.00
【修改日期】2015/5/21 17:56:52
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.01.15
2. 测试版本号为：V20.00
3. 更新strobe filter文件
4. 添加滤波长度寄存器，用于测试

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.01.14
【测试版本】V00.00
【修改日期】2015/5/21 9:21:51
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.01.14
2. 测试版本号为：V10.00
3. 添加测试版本号

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.01.13
【测试版本】V00.00
【修改日期】2015/5/19 16:50:37
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.01.13
2. 添加70-74 5 个测试触发信号的计数器

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.01.12
【测试版本】V00.00
【修改日期】2015/5/19 14:26:53
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.01.12
2. 解决delay模块的bug，当触发延迟参数为0时，不能发出触发信号
trigger_delay_reg	<= iv_trigger_delay;
改为
trigger_delay_reg	<= iv_trigger_delay+1;

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.01.11
【测试版本】V00.00
【修改日期】2015/5/18 10:52:57
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.01.11
2. 解决GPIF无法添加的IOB的问题
--2.1 wr_n 引入到了led_ctrl模块，改为wr_n的之前的一个寄存器输出
--2.2 地址信号再打一拍输出，这样地址切换晚了一拍，即flag的反馈也会晚一拍
--2.3 gpif的输出信号都加上了IOB，fpga片内相对延时已经很小了
3. reg 0x1 : product id 的默认值从0x1234改为0x0
4. 将 pkt_end wr flagb trig 分别引到测试脚上
5. sensor复用的输入信号，引到了电路没有分配的引脚上，M4 bank3。
6. 测试引脚加上下拉电阻，防止天线干扰

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.01.10
【测试版本】V00.00
【修改日期】2015/5/14 9:24:30
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.01.10
2. pulse_filter_en 默认值改为1

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.01.0f
【测试版本】V00.00
【修改日期】2015/5/13 17:49:42
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.01.0f
2. 顶层文件中，u3_interface 的端口映射有误，修改
.iv_transfer_count				(wv_si_payload_transfer_size      	),
.iv_transfer_size				(wv_si_payload_transfer_count      	),
改为
.iv_transfer_count				(wv_si_payload_transfer_count      	),
.iv_transfer_size				(wv_si_payload_transfer_size      	),
3. 修改ise的选项

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.01.0e
【测试版本】V00.00
【修改日期】2015/5/13 13:48:32
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.01.0e
2. 修改 delay 寄存器
3. fix reg list 改为无时钟的结构

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.01.0d
【测试版本】V00.00
【修改日期】2015/5/12 14:17:24
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.01.0d
2. 单元测试之后的集成

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.01.0c
【测试版本】V00.00
【修改日期】2015/4/15 16:00:44
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.01.0c
2. 修改io channel的trigger active的极性
3. test reg是可读可写的寄存器，之前放在了fix reg list中，只能读。现在放到pix reg list里面，可读可写，默认值是16'h55aa

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.01.0b
【测试版本】V00.00
【修改日期】2015/4/13 14:57:02
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.01.0b
2. 版本号次低位改为01，因为之前就是01，改为spi改为64bit时才为02
3. spi协议从64bit改为40bit
4. 寄存器地址恢复为u3寄存器列表的地址
5. 寄存器初值改为0
6. dma size从16k改为32k
7. 加密状态引到sync buffer上

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.02.0a
【测试版本】V00.00
【修改日期】2015/4/8 9:58:44
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.02.0a
2. 修改ucf文档，(1)把slew rate 为fast的约束去掉，(2)在ddr约束中，添加bufpll_mcb_lock的约束
3. 修改sensor复位计数器的逻辑，将时钟复位信号添加到逻辑当中
if(i_reset_sensor)
改为
if(i_reset_sensor==1'b1 || reset_osc_bufg==1'b1)
4. 检查了par报告，目前的残留的问题如下：
(1)ov_usb_fifoaddr[1:0] 不能添加输出iob
(2)o_usb_slwr_n 不能添加输出iob

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.02.09
【测试版本】V00.00
【修改日期】2015/4/8 9:01:03
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.02.09
2. 从张强的目录更新了 帧存 u3v format和u3 interface的模块
3.http://192.168.10.30/svn/hw_mer/branches/zhangqiang/u3v/mer-500-14u3x/fpga/src
5091
4. 可以采图

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.02.08
【测试版本】V00.00
【修改日期】2015/4/3 9:22:17
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.02.08
2. 从张强的目录更新了 帧存 u3v format和u3 interface的模块
3.http://192.168.10.30/svn/hw_mer/branches/zhangqiang/u3v/mer-500-14u3x/fpga/src
5075

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.02.07
【测试版本】V00.00
【修改日期】2015/4/2 17:05:59
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.02.07
2. 修改sync buffer模块
if((fval_shift[1] | fval_reg)==1'b0)
改为
if(fval_shift[1]==1'b0 && fval_reg==1'b0)
逻辑没有变，易读
3. 将sensor输入信号 data fval lval 在iob上打一拍，优化输入时序

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.02.06
【测试版本】V00.00
【修改日期】2015/4/2 16:39:09
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.02.06
2. 修改sync buffer模块

always @ (posedge clk_pix) begin
	if(fval_fall) begin
		delay_20_cnt	<= 5'b0;
	end
	else begin
		if(delay_20_cnt==5'd19) begin
			delay_20_cnt	<= delay_20_cnt;
		end
		else begin
			delay_20_cnt	<= delay_20_cnt + 1'b1;
		end
	end
end
assign	fval_extend	= (delay_20_cnt<5'd19) ? 1'b1 : 1'b0;

改为
always @ (posedge clk_pix) begin
	if(enable==1'b0) begin
		delay_20_cnt<=5'd19;
	end
	else begin
		if(fval_fall==1'b1) begin
			delay_20_cnt	<= 5'b0;
		end
		else begin
			if(delay_20_cnt==5'd19) begin
				delay_20_cnt	<= delay_20_cnt;
			end
			else begin
				delay_20_cnt	<= delay_20_cnt + 1'b1;
			end
		end
	end
end
assign	fval_extend	= (delay_20_cnt<5'd19) ? 1'b1 : 1'b0;

解决了在一帧中间开采，输出残帧的问题

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.02.05
【测试版本】V00.00
【修改日期】2015/4/2 14:04:11
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.02.05
2. 灰度统计方法做了修改，10bit时，只统计高8bit

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.02.04
【测试版本】V00.00
【修改日期】2015/4/1 17:54:09
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.02.04
2. 张强更新了一些文件
frame buffer、u3v format、u3 interface
3. 帧存 rd logic模块，修改了写后端fifo的方法，最后一个burst的残包不写入后端fifo
4. u3_transfer.v 修改读后端fifo的逻辑，之前会多读出来一个数据
5. u3v_format_control.v lead flag 长度加宽
6. 测试结果，数据量还是不足，少了52个字节

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.02.03
【测试版本】V00.00
【修改日期】2015/4/1 10:50:13
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.02.03
2. 所有没有用到的寄存器，除去  vendor id、开停采、max。其他的寄存器地址都加上0x100，这样就不会有冲突

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.02.02
【测试版本】V00.00
【修改日期】2015/4/1 10:13:22
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.02.02
2. 两个开采信号改为默认低电平

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.02.01
【测试版本】V00.00
【修改日期】2015/4/1 8:42:17
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.02.01
2. 3014 DMA SIZE 改为16k
localparam		DMA_SIZE		 		= 16'h1000	;	//DMA SIZE大小
3. u3 interface 的payload size，参数映射
从		.iv_payload_size				({2'b00,wv_payload_size_gpif[31:2]}	),
改为	.iv_payload_size				(wv_payload_size_gpif				),

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.01.03
【测试版本】V00.00
【修改日期】2015/3/31 18:14:45
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.01.03
2. 修改lead.v，在文件尾部添加
else begin
	o_data_valid	<=	1'b0;
end
---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.01.02
【测试版本】V00.00
【修改日期】2015/3/31 18:10:21
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.01.02
2. 修改控制通道，把spi的改回之前的协议模式，即从40bit改回64bit
3. 可以打开设备，能够读到只读寄存器，但是不能获取图像，帧率是0

---------------------------------------------------------------------------------------------------------
【主版本  】V01.02.01.01
【测试版本】V00.00
【修改日期】2015/3/31 17:27:51
【修改人  】邢海涛
【调试仿真环境】Xilinx ISE 14.7
---------------------------------------------------------------------------------------------------------
【修改详细记录】：
1. 主版本号为：V01.02.01.01
2. 将所有二级模块都连接起来
3. 时序分析通过，能够生成bin文件
4. gpif的addr 0-1 wr 没有能添加到IOB上，其他的gpif信号都已经添加到iob上

---------------------------------------------------------------------------------------------------------
版本号说明
---------------------------------------------------------------------------------------------------------
FPGA 代码 版本号 共32位，共分为4个byte，从高到低分别为 1 2 3 4byte
byte 1 ：大恒公版为0x01，其他定制版依次递增
byte 2 ：PCB版本，初始为0x01，电路板发生变化，造成需要升级FPGA程序的时候，修改该版本
byte 3 ：发布版本，初始为0x01，每次对用户升级发布时，修改此位。对用户发布定义为只要用户拿到相机就算发布。入库前保证此版本升级
byte 4 ：研发版本，初始为0x00，用户可见。研发人员在开发过程中使用。联调、测试、提交项目组的需修改此位进行版本控制。

测试版本
用户不可见，设计人员自己调试使用。连调不允许使用此位进行版本控制――包括部门内和部门间
mer-500-14u3x 测试版本号规则如下：
0x1xxx 为张强调试版本号
0x2xxx 为邢海涛调试版本号
